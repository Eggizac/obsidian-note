
# Практическая работа  
**Нормализация отношения из 3НФ в НФК**  
**Предметная область: Магазин (ассортимент товаров)**

---

### 1. Структура атрибутов исходного отношения  
**Исходное отношение - Товар**  
**Атрибуты**

| Атрибут             |
|---------------------|
| Код товара          |
| Категория товара  |
| Отдел               |

---

### 2. Пример наполнения исходного отношения данными  

| Код товара | Категория товара      | Отдел            |
|------------|-----------------------|------------------|
| T1001      | Смартфоны             | Электроника      |
| T1002      | Чехлы                 | Аксессуары       |
| T1003      | Наушники              | Аксессуары       |
| T1004      | Планшеты              | Электроника      |
| T1005      | Флешки                | Аксессуары       |

---

### 3. Схема атрибутов отношения с зависимостями  
1. {Категория товара} -> {Отдел}
2. {Код товара} -> {Категория товара, отдел}


---

### 4. Текстовое описание функциональных зависимостей  
a. **Функциональная зависимость**  
  {Категория товара} - {Отдел}    
Каждая категория товаров размещается строго в одном отделе магазина  
(например, все «Смартфоны» и «Планшеты» — в отделе «Электроника», все «Чехлы», «Наушники», «Флешки» — в «Аксессуары»).  
**Детерминант — Категория товара**

b. **Функциональная зависимость**  
  {Код товара} - {Категория товара, Отдел}  

---

### 5. Текстовое описание всех атрибутов отношения  
- **Код товара** — уникальный артикул товара (первичный ключ).  
- **Категория товара** — название категории (Смартфоны, Чехлы, Наушники и т.д.).  
- **Отдел** — название отдела магазина, в котором продаётся товар.

---

### 6. Определение ключей  
**Первичный ключ** — **Код товара** (простой ключ)

---

### 7. Определение нормальной формы исходного отношения  
Отношение находится в **3НФ**, но **не в НФБК**, потому что:  
- 1НФ, 2НФ, 3НФ выполнены (нет частичных и транзитивных зависимостей через другие атрибуты).  
- Однако существует **детерминант {Категория товара}**, который **не является суперключом**, но определяет неключевой атрибут **Отдел** - нарушение НФБК.

---

### 8. Аномалии исходного отношения  
- **Вставки**: нельзя добавить новую категорию с указанием отдела без создания хотя бы одного товара этой категории.  
- **Удаления**: удаление последнего товара категории «Чехлы» - потеря информации, что категория относится к отделу «Аксессуары».  
- **Обновления**: перенос категории «Наушники» из «Аксессуары» в «Аудиотехника» требует изменения всех строк с этой категорией.

---

### 9. Иллюстрация аномалий  
- Хотим добавить категорию «Кабели» в отдел «Аксессуары» - вынуждены придумать фиктивный товар.  
- Удаляем последний товар T1005 - теряем факт, что категория «Флешки» относится к «Аксессуары».  
- Меняем отдел для категории «Планшеты» - нужно обновить все строки с этой категорией.

---

### 10. Для устранения аномалий следует произвести  
Декомпозицию с вынесением зависимости   Категория товара - Отдел   в отдельное отношение.

---

### 11. Результат выполнения нормализации (НФБК)

| Новое отношение        | Схема                                    | Первичный ключ        |
|-------------------------|------------------------------------------|------------------------|
| Категория_товара        | {Категория товара} - {Отдел}              | Категория товара       |
| Товар                   | {Код товара} - {Категория товара}        | Код товара             |

---

### 12. Иллюстрация того, что аномалии пропали  
- **Вставка**: новая категория «Кабели» + отдел «Аксессуары» — одна строка в таблице   Категория_товара  .  
- **Удаление**: удаление всех товаров категории не удаляет информацию об отделе.  
- **Обновление**: смена отдела для категории — одна операция в таблице   Категория_товара  .

---

### 13. Причина аномалий  
Наличие детерминанта **Категория товара**, который не является суперключом отношения, но определяет неключевой атрибут **Отдел**.

---

### 14. Проверка полученных отношений  

| Отношение              | 1НФ | 2НФ | 3НФ | НФБК | Обоснование |
|------------------------|-----|-----|-----|------|-------------|
| Категория_товара       | Yes | Yes | Yes | Yes | Детерминант = ключ |
| Товар                  | Yes | Yes | Yes | Yes | Детерминант = ключ |

---
# Практическая работа  
**Нормализация отношения из НФБК в 4НФ**  
**Предметная область: Интернет-магазин (заказы покупателей)**

---

### 1. Структура атрибутов исходного отношения  
**Исходное отношение - Заказ**  
**Атрибуты**

| Атрибут               |
|-----------------------|
| Код покупателя        |
| Код товара            |
| Способ доставки       |

---

### 2. Пример наполнения исходного отношения данными  

| Код покупателя | Код товара | Способ доставки     |
|----------------|------------|---------------------|
| C001           | T101       | Курьер              |
| C001           | T101       | Самовывоз           |
| C001           | T205       | Курьер              |
| C001           | T205       | Самовывоз           |
| C002           | T101       | Почта России        |
| C002           | T101       | СДЭК                |

---

### 3. Схема атрибутов отношения с зависимостями  
1. {Код покупателя} -> {Код товара}
2. {Код покупателя} -> {Способ доставки}


---

### 4. Текстовое описание зависимостей  
a. **Многозначная зависимость**  
  {Код покупателя} -- {Код товара}    
Один покупатель может заказывать много разных товаров независимо от способов доставки.

b. **Многозначная зависимость**  
  {Код покупателя} -- {Способ доставки}    
Один покупатель может использовать несколько способов доставки независимо от того, какие товары он заказывает.

**Детерминант обеих MVD — Код покупателя**

---

### 5. Текстовое описание всех атрибутов отношения  
- **Код покупателя** — уникальный идентификатор клиента магазина.  
- **Код товара** — уникальный артикул товара.  
- **Способ доставки** — вариант доставки (Курьер, Самовывоз, Почта России, СДЭК и т.д.).

---

### 6. Определение ключей  
**Первичный ключ** — составной  
  {Код покупателя, Код товара, Способ доставки}  

---

### 7. Определение нормальной формы исходного отношения  
Отношение находится в **НФБК**, но **не в 4НФ**, потому что:  
- Нет неключевых атрибутов - нет функциональных зависимостей - НФБК выполнена.  
- Присутствуют две **нетривиальные многозначные зависимости** с общим детерминантом «Код покупателя», который **не является суперключом** - нарушение 4НФ.

---

### 8. Аномалии исходного отношения  
- Нельзя добавить покупателя без указания хотя бы одного товара и одного способа доставки.  
- При удалении всех строк теряется сам факт существования покупателя.  
- Сильная избыточность: добавление нового товара или нового способа доставки требует дублирования всех комбинаций.

---

### 9. Иллюстрация аномалий  
Покупатель C003 выбрал «Курьер» и «Самовывоз», заказал T300 и T400 - нужно вставить **4 строки**.  
Удаляем все строки покупателя C001 - покупатель исчезает из системы.  
Добавляем к C001 новый товар T777 - нужно добавить 2 строки (для каждого способа доставки).

---

### 10. Для устранения аномалий следует произвести  
Классическую декомпозицию по двум многозначным зависимостям на **три отношения**.

---

### 11. Результат выполнения нормализации (4НФ)

| Новое отношение               | Схема                                             | Первичный ключ                     |
|--------------------------------|---------------------------------------------------|------------------------------------|
| Покупатель                     | {Код покупателя}                                 | Код покупателя                     |
| Покупатель_Товар               | {Код покупателя, Код товара}                      | {Код покупателя, Код товара}       |
| Покупатель_Способ_доставки     | {Код покупателя, Способ доставки}                 | {Код покупателя, Способ доставки}  |

---

### 12. Иллюстрация того, что аномалии пропали  
- Новый покупатель C999 добавляется одной строкой в таблицу **Покупатель** — без товаров и способов доставки.  
- Добавление нового товара или способа доставки — по одной строке без дублирования.  
- Удаление всех товаров или всех способов доставки **не удаляет самого покупателя**.

---

### 13. Причина аномалий  
Две **нетривиальные многозначные зависимости** с детерминантом «Код покупателя», который не является суперключом исходного отношения.

---

### 14. Проверка полученных отношений на 4НФ

| Отношение                      | 1НФ | 2НФ | 3НФ | НФБК | 4НФ | Обоснование                         |
|--------------------------------|------|------|------|------|------|-------------------------------------|
| Покупатель                     | Yes  | Yes  | Yes  | Yes  | Yes  | Только ключ                        |
| Покупатель_Товар               | Yes  | Yes  | Yes  | Yes  | Yes  | Нет неключевых атрибутов - нет MVD  |
| Покупатель_Способ_доставки     | Yes  | Yes  | Yes  | Yes  | Yes  | Yes  | Нет неключевых атрибутов - нет MVD  |

---
