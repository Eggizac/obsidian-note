# Практическая работа  
**Нормализация отношения из 3НФ в НФБК**  
**Предметная область: Железнодорожные перевозки**

---

### 1. Структура атрибутов исходного отношения  
**Исходное отношение – Поезд**  
**Атрибуты**

| Атрибут         |
|-----------------|
| НомерПоезда     |
| ТипПоезда       |
| Категория       |

---

### 2. Пример наполнения исходного отношения данными  

| НомерПоезда | ТипПоезда        | Категория       |
|-------------|------------------|-----------------|
| 001А        | Фирменный        | Пассажирский    |
| 002А        | Скорый           | Пассажирский    |
| 015Е        | Фирменный        | Пассажирский    |
| 725М        | Ласточка         | Электропоезд    |
| 736М        | Ласточка         | Электропоезд    |

---

### 3. Схема атрибутов отношения с зависимостями  
![[Снимок экрана 2025-11-17 в 19.43.31.png]]

---

### 4. Текстовое описание зависимостей  
a. **Функциональная зависимость**  {ТипПоезда} → {Категория}   
   Каждый тип поезда имеет строго одну категорию (например, все «Ласточки» — электропоезда, все «Фирменные» — пассажирские).  
   **Детерминант – ТипПоезда** (простой атрибут)  

b. **Функциональная зависимость**  {НомерПоезда} → {ТипПоезда, Категория}   
   По номеру поезда однозначно определяется его тип и категория.  
   **Детерминант – НомерПоезда**

---

### 5. Текстовое описание всех атрибутов отношения  
- **НомерПоезда** — уникальный номер поезда (например, 001А, 725М). Первичный ключ.  
- **ТипПоезда** — тип поезда (Фирменный, Скорый, Лároчка и т.д.).  
- **Категория** — категория поезда (Пассажирский, Электропоезд, Грузовой и т.д.).

---

### 6. Определение ключей  
**Первичный ключ** – **НомерПоезда**  
**Потенциальных ключей** больше нет.

---

### 7. Определение нормальной формы исходного отношения  
Отношение находится в **3НФ**, потому что:  
- Значения атомарны → 1НФ  
- Ключ простой → нет частичных зависимостей → 2НФ  
- Нет транзитивных зависимостей через неключевые атрибуты → 3НФ  

**НО НЕ в НФБК**, потому что:  
- Существует детерминант **ТипПоезда → Категория**, который **не является суперключом** (не совпадает с НомерПоезда и не содержит его).  
→ Нарушение НФБК.

---

### 8. Аномалии исходного отношения  
a. **Аномалия вставки**: нельзя добавить новый тип поезда с его категорией без создания хотя бы одного поезда этого типа  
b. **Аномалия удаления**: при удалении последнего поезда типа «Ласточка» теряется информация, что «Ласточка» — это электропоезд  
c. **Аномалия обновления**: смена категории для типа «Фирменный» требует изменения во всех строках с этим типом

---

### 9. Иллюстрация аномалий  
- Хотим добавить новый тип «Стриж» (категория — скоростной электропоезд) → вынуждены придумать фиктивный номер поезда.  
- Удаляем последний поезд 736М → исчезает факт, что «Ласточка» — это электропоезд.  
- Решаем перевести все «Фирменные» поезда в категорию «Премиум» → нужно обновить все строки с ТипПоезда = «Фирменный».

---

### 10. Для устранения этих аномалий следует произвести  
Декомпозицию отношения с вынесением зависимости  ТипПоезда → Категория  в отдельную таблицу.

---

### 11. Результат выполнения нормализации (НФБК)  

#### i. ТипПоезда  
Схема:  {ТипПоезда} → {Категория}   
Ключ: **ТипПоезда**

#### ii. Поезд  
Схема:  {НомерПоезда} → {ТипПоезда}   
Ключ: **НомерПоезда**

---

### 12. Иллюстрация того, что обозначенные выше аномалии в полученных отношениях пропали  
- **Вставка**: новый тип «Стриж» + категория «Скоростной электропоезд» добавляется одной строкой в таблицу  ТипПоезда  без создания поезда.  
- **Удаление**: удаление всех поездов типа «Ласточка» не удаляет запись о том, что «Ласточка» — электропоезд.  
- **Обновление**: изменение категории «Фирменный» → «Премиум» — одна операция в таблице  ТипПоезда .

---

### 13. Причина аномалий в исходном отношении  
Наличие детерминанта **ТипПоезда**, который определяет неключевой атрибут **Категория**, но не является суперключом отношения.

---

### 14. Проверка полученных отношений на соответствие нормальным формам  

| Отношение       | 1НФ | 2НФ | 3НФ | НФБК | Обоснование |
|-----------------|-----|-----|-----|------|-------------|
| **ТипПоезда** ( ТипПоезда ,  Категория ) | Yes | Yes | Yes | Yes | Детерминант ТипПоезда = ключ → суперключ |
| **Поезд** ( НомерПоезда ,  ТипПоезда )   | Yes | Yes | Yes | Yes | Детерминант НомерПоезда = ключ → суперключ |

---

# Практическая работа  
**Нормализация отношения из НФБК в 4НФ**  
**Предметная область: Авиакомпания (рейсы)**

---

### 1. Структура атрибутов исходного отношения  
**Исходное отношение – Рейс**  
**Атрибуты**

| Атрибут               |
|-----------------------|
| НомерРейса            |
| ВокзалОтправления     |
| Услуга                |

---

### 2. Пример наполнения исходного отношения данными  

| НомерРейса | ВокзалОтправления | Услуга               |
|------------|-------------------|----------------------|
| SU123      | Шереметьево       | Бизнес-зал           |
| SU123      | Шереметьево       | Приоритетная посадка |
| SU123      | Шереметьево       | Доп. багаж           |
| SU456      | Домодедово        | Бизнес-зал           |
| SU456      | Домодедово        | Приоритетная посадка |
| SU789      | Внуково           | Доп. багаж           |

---

### 3. Схема атрибутов отношения с зависимостями  
![[Снимок экрана 2025-11-17 в 19.45.26.png]]

---

### 4. Текстовое описание зависимостей  
a. **Многозначная зависимость** `{НомерРейса} →→ {ВокзалОтправления}`  
   Один рейс всегда вылетает из одного и того же аэропорта (вокзала), независимо от предоставляемых услуг.  

b. **Многозначная зависимость** `{НомерРейса} →→ {Услуга}`  
   Один рейс может предоставлять несколько дополнительных услуг, независимо от аэропорта вылета.  

**Детерминант обеих MVD – НомерРейса** (простой атрибут)

---

### 5. Текстовое описание всех атрибутов отношения  
- **НомерРейса** — уникальный номер рейса авиакомпании (например, SU123).  
- **ВокзалОтправления** — аэропорт вылета (Шереметьево, Домодедово, Внуково).  
- **Услуга** — дополнительная услуга, включённая в тариф рейса (Бизнес-зал, Приоритетная посадка, Доп. багаж и т.д.).

---

### 6. Определение ключей  
**Первичный ключ** — составной `{НомерРейса, ВокзалОтправления, Услуга}`  
Нет неключевых атрибутов → нет функциональных зависимостей.

---

### 7. Определение нормальной формы исходного отношения  
Отношение находится в **НФБК**, потому что:  
- Атомарные значения → 1НФ  
- Нет частичных зависимостей → 2НФ  
- Нет транзитивных зависимостей → 3НФ  
- Нет неключевых атрибутов → нет ФЗ → **НФБК выполнена**  

**НО НЕ в 4НФ**, потому что:  
- Существуют две **нетривиальные многозначные зависимости**:  
  `{НомерРейса} →→ {ВокзалОтправления}`  
  `{НомерРейса} →→ {Услуга}`  
- Детерминант **НомерРейса** не является суперключом (суперключ — все три атрибута).

---

### 8. Аномалии исходного отношения  
a. **Аномалия вставки**: нельзя добавить новый рейс без указания хотя бы одной услуги и вокзала  
b. **Аномалия удаления**: удаление всех услуг для рейса → потеря самого рейса и вокзала  
c. **Избыточность**: добавление новой услуги к рейсу требует дублирования вокзала

---

### 9. Иллюстрация аномалий  
- Хотим добавить рейс SU999 из Пулково → нужно придумать хотя бы одну услугу.  
- Удаляем все услуги у рейса SU123 → исчезает информация, что он вылетает из Шереметьево.  
- Добавляем услугу «Wi-Fi на борту» к SU123 → нужно ещё раз написать «Шереметьево».

---

### 10. Для устранения этих аномалий следует произвести  
Декомпозицию отношения по двум многозначным зависимостям на три таблицы (классическая декомпозиция для 4НФ).

---

### 11. Результат выполнения нормализации (4НФ)  

#### i. Рейс  
Схема: `{НомерРейса}`  
Ключ: **НомерРейса**

#### ii. Рейс_Вокзал  
Схема: `{НомерРейса, ВокзалОтправления}`  
Ключ: **НомерРейса** (поскольку вокзал у рейса один)

#### iii. Рейс_Услуга  
Схема: `{НомерРейса, Услуга}`  
Ключ: **{НомерРейса, Услуга}**

---

### 12. Иллюстрация того, что обозначенные выше аномалии в полученных отношениях пропали  
- **Вставка**: новый рейс SU999 добавляется одной строкой в таблицу `Рейс`, потом независимо добавляются вокзал и услуги.  
- **Удаление**: удаление всех услуг не удаляет сам рейс и его вокзал.  
- **Избыточность**: вокзал и услуги хранятся без дублирования.

---

### 13. Причина аномалий в исходном отношении  
Наличие двух **нетривиальных многозначных зависимостей** с общим детерминантом `НомерРейса`, который не является суперключом.

---

### 14. Проверка полученных отношений на соответствие нормальным формам  

| Отношение           | 1НФ | 2НФ | 3НФ | НФБК | 4НФ | Обоснование |
|---------------------|-----|-----|-----|------|-----|-------------|
| **Рейс**            | Yes | Yes | Yes | Yes | Yes | Только ключ |
| **Рейс_Вокзал**     | Yes | Yes | Yes | Yes | Yes | Нет неключевых атрибутов |
| **Рейс_Услуга**     | Yes | Yes | Yes | Yes | Yes | Нет неключевых атрибутов → нет MVD |

---

